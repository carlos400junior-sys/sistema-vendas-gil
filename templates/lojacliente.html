<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>JML EletrÃ´nica</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --primary:#2563eb;
    --primary-dark:#1e40af;
    --bg:#f1f5f9;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
    --radius:18px;
}

*{box-sizing:border-box}

body{
    margin:0;
    font-family:'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont;
    background:var(--bg);
    color:var(--text);
}

/* HEADER */
header{
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    padding:18px;
    color:white;
    box-shadow:0 6px 18px rgba(0,0,0,.18);
}

.header-inner{
    max-width:1200px;
    margin:auto;
    display:flex;
    align-items:center;
    gap:14px;
}

header h1{
    margin:0;
    font-size:22px;
    font-weight:800;
    letter-spacing:.3px;
}

.search-box{
    flex:1;
    position:relative;
}

.search-box input{
    width:100%;
    padding:12px 16px;
    border-radius:999px;
    border:none;
    font-size:14px;
    outline:none;
}

.cart-btn{
    cursor:pointer;
    font-size:24px;
    position:relative;
}

.cart-btn span{
    position:absolute;
    top:-6px;
    right:-8px;
    background:white;
    color:var(--primary);
    font-size:12px;
    padding:2px 7px;
    border-radius:999px;
    font-weight:800;
}

/* CONTAINER */
.container{
    max-width:1200px;
    margin:auto;
    padding:22px;
}

/* GRID */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
    gap:20px;
}

/* CARD */
.card{
    background:var(--card);
    border-radius:var(--radius);
    overflow:hidden;
    box-shadow:0 12px 28px rgba(0,0,0,.08);
    transition:.35s ease;
    display:flex;
    flex-direction:column;
}

.card:hover{
    transform:translateY(-8px);
    box-shadow:0 25px 45px rgba(37,99,235,.25);
}

.card img{
    width:100%;
    aspect-ratio:1/1;
    object-fit:cover;
}

.card .info{
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:8px;
}

.card h3{
    font-size:14px;
    font-weight:700;
    line-height:1.25rem;
    height:2.5rem;
    overflow:hidden;
}

.price{
    color:var(--primary);
    font-size:17px;
    font-weight:900;
}

.card button{
    margin-top:8px;
    border:none;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:white;
    padding:11px;
    cursor:pointer;
    border-radius:14px;
    font-size:14px;
    font-weight:700;
    transition:.3s;
}

.card button:hover{
    opacity:.95;
    transform:scale(1.04);
}

/* OVERLAY */
.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.55);
    display:none;
}

/* CARRINHO */
.cart{
    position:fixed;
    right:-100%;
    top:0;
    width:100%;
    max-width:400px;
    height:100%;
    background:white;
    padding:22px;
    transition:.4s;
    display:flex;
    flex-direction:column;
    border-radius:28px 0 0 28px;
}

.cart.active{right:0}

.cart h2{
    margin:0 0 12px;
    font-size:22px;
    font-weight:800;
}

.cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
    font-size:14px;
}

.controls{
    display:flex;
    gap:6px;
}

.controls button{
    width:30px;
    height:30px;
    border:none;
    background:var(--primary);
    color:white;
    cursor:pointer;
    border-radius:10px;
    font-size:16px;
}

.total{
    font-size:20px;
    font-weight:900;
    margin-top:auto;
    padding-top:14px;
    border-top:1px solid #e5e7eb;
}

input{
    width:100%;
    padding:12px;
    margin:10px 0;
    border:1px solid #cbd5e1;
    border-radius:14px;
    font-size:14px;
}

/* FINALIZAR */
.finalizar{
    background:linear-gradient(135deg,#22c55e,#16a34a);
    color:white;
    border:none;
    padding:16px;
    margin-top:16px;
    font-size:16px;
    border-radius:18px;
    cursor:pointer;
    font-weight:800;
    transition:.3s;
}

.finalizar:hover{
    transform:scale(1.03);
}
</style>
</head>

<body>

<header>
    <div class="header-inner">
        <h1>JML EletrÃ´nica</h1>

        <div class="search-box">
            <input
                type="text"
                id="search"
                placeholder="Buscar produto..."
                oninput="buscarProduto()">
        </div>

        <div class="cart-btn" onclick="toggleCart()">
            ðŸ›’ <span id="count">0</span>
        </div>
    </div>
</header>

<div class="container">
    <div class="grid" id="produtos">
        {% for p in produtos %}
        <div class="card" data-nome="{{ p.nome|lower }}">
            {% if p.foto %}
                <img src="{{ url_for('static', filename='uploads/' ~ p.foto) }}">
            {% endif %}
            <div class="info">
                <h3>{{ p.nome }}</h3>
                <div class="price">R$ {{ "%.2f"|format(p.preco) }}</div>
                <button onclick="addItem('{{ p.nome }}', {{ p.preco }})">
                    Adicionar
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="overlay" id="overlay" onclick="toggleCart()"></div>

<div class="cart" id="cart">
    <h2>Meu Carrinho</h2>

    <input id="nomeCliente" placeholder="Seu nome completo">

    <div id="cartItems"></div>

    <div class="total">
        Total: R$ <span id="total">0.00</span>
    </div>

    <button class="finalizar" onclick="finalizarWhatsapp()">
        FINALIZAR NO WHATSAPP
    </button>
</div>

<script>
let carrinho = [];

function toggleCart(){
    cart.classList.toggle("active");
    overlay.style.display = cart.classList.contains("active") ? "block" : "none";
}

function addItem(nome, preco){
    const item = carrinho.find(i => i.nome === nome);
    item ? item.qtd++ : carrinho.push({nome, preco, qtd:1});
    animateCart();
    updateCart();
}

function updateCart(){
    cartItems.innerHTML = "";
    let total = 0, count = 0;

    carrinho.forEach((i, index)=>{
        total += i.preco * i.qtd;
        count += i.qtd;
        cartItems.innerHTML += `
            <div class="cart-item">
                <span>${i.qtd}x ${i.nome}</span>
                <div class="controls">
                    <button onclick="alterar(${index}, -1)">âˆ’</button>
                    <button onclick="alterar(${index}, 1)">+</button>
                </div>
            </div>
        `;
    });

    totalSpan.innerText = total.toFixed(2);
    countSpan.innerText = count;
}

function alterar(i, v){
    carrinho[i].qtd += v;
    if(carrinho[i].qtd <= 0) carrinho.splice(i,1);
    updateCart();
}

function animateCart(){
    cartBtn.style.transform = "scale(1.3)";
    setTimeout(()=>cartBtn.style.transform="scale(1)",200);
}

function buscarProduto(){
    const termo = search.value.toLowerCase();
    document.querySelectorAll(".card").forEach(card=>{
        card.style.display =
            card.dataset.nome.includes(termo) ? "flex" : "none";
    });
}

function finalizarWhatsapp(){
    if(!carrinho.length) return alert("Carrinho vazio");
    const nome = nomeCliente.value.trim();
    if(!nome) return alert("Informe seu nome");

    let msg = `ðŸ›’ *NOVO PEDIDO - JML ELETRÃ”NICA*%0AðŸ‘¤ *Cliente:* ${nome}%0A%0A`;
    let total = 0;

    carrinho.forEach(i=>{
        msg += `â€¢ ${i.qtd}x ${i.nome} - R$ ${(i.preco*i.qtd).toFixed(2)}%0A`;
        total += i.preco*i.qtd;
    });

    msg += `%0AðŸ’° *Total:* R$ ${total.toFixed(2)}`;
    window.open(`https://wa.me/5581991644068?text=${msg}`,"_blank");
}
</script>

</body>
</html>
