<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>JML EletrÃ´nica</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --primary:#2563eb;      /* Azul principal */
    --primary-dark:#1e40af; /* Azul escuro */
    --bg:#f1f5f9;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
}

*{box-sizing:border-box}

body{
    margin:0;
    font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
}

/* HEADER */
header{
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    padding:16px;
    color:white;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:0 4px 12px rgba(0,0,0,.15);
}

header h1{
    margin:0;
    font-size:22px;
    font-weight:700;
}

.cart-btn{
    cursor:pointer;
    font-size:24px;
    position:relative;
}

.cart-btn span{
    position:absolute;
    top:-6px;
    right:-8px;
    background:white;
    color:var(--primary);
    font-size:12px;
    padding:2px 7px;
    border-radius:999px;
    font-weight:700;
}

/* CONTAINER */
.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}

/* GRID */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
    gap:18px;
}

/* CARD PRODUTO */
.card{
    background:var(--card);
    border-radius:20px;
    overflow:hidden;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
    transition:.35s ease;
    display:flex;
    flex-direction:column;
}

.card:hover{
    transform:translateY(-6px);
    box-shadow:0 20px 40px rgba(37,99,235,.25);
}

.card img{
    width:100%;
    aspect-ratio:1/1;
    object-fit:cover;
}

.card .info{
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:6px;
}

.card h3{
    font-size:14px;
    font-weight:600;
    line-height:1.2rem;
    height:2.4rem;
    overflow:hidden;
}

.price{
    color:var(--primary);
    font-size:16px;
    font-weight:800;
}

.card button{
    margin-top:8px;
    border:none;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:white;
    padding:10px;
    cursor:pointer;
    border-radius:12px;
    font-size:14px;
    font-weight:600;
    transition:.3s;
}

.card button:hover{
    opacity:.9;
    transform:scale(1.02);
}

/* OVERLAY */
.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.55);
    display:none;
}

/* CARRINHO */
.cart{
    position:fixed;
    right:-100%;
    top:0;
    width:100%;
    max-width:380px;
    height:100%;
    background:white;
    padding:20px;
    transition:.4s;
    display:flex;
    flex-direction:column;
    border-radius:24px 0 0 24px;
}

.cart.active{right:0}

.cart h2{
    margin:0 0 10px;
    font-size:22px;
    font-weight:700;
}

.cart-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
    font-size:14px;
}

.controls{
    display:flex;
    gap:6px;
}

.controls button{
    width:28px;
    height:28px;
    border:none;
    background:var(--primary);
    color:white;
    cursor:pointer;
    border-radius:8px;
    font-size:16px;
}

.total{
    font-size:20px;
    font-weight:800;
    margin-top:auto;
    padding-top:10px;
    border-top:1px solid #e5e7eb;
}

input{
    width:100%;
    padding:12px;
    margin:10px 0;
    border:1px solid #cbd5e1;
    border-radius:12px;
    font-size:14px;
}

/* BOTÃƒO FINALIZAR */
.finalizar{
    background:linear-gradient(135deg,#22c55e,#16a34a);
    color:white;
    border:none;
    padding:15px;
    margin-top:15px;
    font-size:16px;
    border-radius:16px;
    cursor:pointer;
    font-weight:700;
    transition:.3s;
}

.finalizar:hover{
    opacity:.9;
    transform:scale(1.02);
}
</style>

</head>

<body>

<header>
    <h1>JML EletrÃ´nica</h1>
    <div class="cart-btn" onclick="toggleCart()">
        ðŸ›’ <span id="count">0</span>
    </div>
</header>

<div class="container">
    <div class="grid">
        {% for p in produtos %}
        <div class="card">
            {% if p.foto %}
                <img src="{{ url_for('static', filename='uploads/' ~ p.foto) }}">
            {% endif %}
            <div class="info">
                <h3>{{ p.nome }}</h3>
                <div class="price">R$ {{ "%.2f"|format(p.preco) }}</div>
                <button onclick="addItem('{{ p.nome }}', {{ p.preco }})">
                    Adicionar
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="overlay" id="overlay" onclick="toggleCart()"></div>

<div class="cart" id="cart">
    <h2>Meu Carrinho</h2>

    <input id="nomeCliente" placeholder="Seu nome completo">

    <div id="cartItems"></div>

    <div class="total">
        Total: R$ <span id="total">0.00</span>
    </div>

    <button class="finalizar" onclick="finalizarWhatsapp()">
        FINALIZAR NO WHATSAPP
    </button>
</div>

<script>
let carrinho = [];

function toggleCart(){
    document.getElementById("cart").classList.toggle("active");
    document.getElementById("overlay").style.display =
        document.getElementById("cart").classList.contains("active") ? "block" : "none";
}

function addItem(nome, preco){
    const item = carrinho.find(i => i.nome === nome);
    if(item) item.qtd++;
    else carrinho.push({nome, preco, qtd:1});
    animateCart();
    updateCart();
}

function updateCart(){
    const box = document.getElementById("cartItems");
    let total = 0, count = 0;
    box.innerHTML = "";

    carrinho.forEach((i, index)=>{
        total += i.preco * i.qtd;
        count += i.qtd;

        box.innerHTML += `
            <div class="cart-item">
                <span>${i.qtd}x ${i.nome}</span>
                <div class="controls">
                    <button onclick="alterar(${index}, -1)">âˆ’</button>
                    <button onclick="alterar(${index}, 1)">+</button>
                </div>
            </div>
        `;
    });

    document.getElementById("total").innerText = total.toFixed(2);
    document.getElementById("count").innerText = count;
}

function alterar(index, valor){
    carrinho[index].qtd += valor;
    if(carrinho[index].qtd <= 0) carrinho.splice(index,1);
    updateCart();
}

function animateCart(){
    const btn = document.querySelector(".cart-btn");
    btn.style.transform = "scale(1.3)";
    setTimeout(()=>btn.style.transform="scale(1)",200);
}

function finalizarWhatsapp(){
    if(!carrinho.length){
        alert("Carrinho vazio");
        return;
    }

    const nome = document.getElementById("nomeCliente").value.trim();
    if(!nome){
        alert("Informe seu nome");
        return;
    }

    let msg = `ðŸ›’ *NOVO PEDIDO - JML ELETRÃ”NICA*%0A%0A`;
    msg += `ðŸ‘¤ *Cliente:* ${nome}%0A%0A`;

    let total = 0;
    carrinho.forEach(i=>{
        msg += `â€¢ ${i.qtd}x ${i.nome} - R$ ${(i.preco*i.qtd).toFixed(2)}%0A`;
        total += i.preco*i.qtd;
    });

    msg += `%0AðŸ’° *Total:* R$ ${total.toFixed(2)}`;

    window.open(
        `https://wa.me/5581991644068?text=${msg}`,
        "_blank"
    );
}
</script>

</body>
</html>
